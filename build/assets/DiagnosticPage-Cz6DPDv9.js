import{c as m,r as x,j as e}from"./index-BvAVGMc_.js";import{B as j,R as u}from"./button-CuMZ8WHe.js";import{L as b}from"./loader-circle-VCEppdCB.js";import{C as N}from"./circle-check-C7-k68BP.js";import"./utils-BXyitJ0x.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],h=m("circle-alert",y);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],w=m("circle-x",f);function O({onNavigate:k,onBack:v}){const[t,p]=x.useState({}),[a,o]=x.useState(!1),n="https://script.google.com/macros/s/AKfycbz8PasKHgjeBS5DjJ8KS5g0eqW82Yb6P9t5X0ttXD2w9Y878lsV7jRegrRiDHq8LkeI/exec",g=async()=>{o(!0);const s={};console.log("üß™ Test 1: Testing basic GET request...");try{const r=await fetch(n,{method:"GET",mode:"cors",cache:"no-cache"});if(s.get={status:r.status,ok:r.ok,statusText:r.statusText},r.ok){const c=await r.text();try{const l=JSON.parse(c);s.get.data=l,s.get.success=!0}catch{s.get.rawResponse=c,s.get.parseError="Response is not JSON"}}}catch(r){s.get={success:!1,error:r.toString(),message:r.message}}console.log("üß™ Test 2: Testing POST request (registration)...");try{const r="test"+Date.now()+"@example.com",c=await fetch(n,{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"register",email:r,password:"Test123!",firstName:"Diagnostic",phone:"+2348012345678"})});if(s.post={status:c.status,ok:c.ok},c.ok){const l=await c.text();try{const i=JSON.parse(l);s.post.data=i,s.post.success=i.success}catch{s.post.rawResponse=l,s.post.parseError="Response is not JSON"}}}catch(r){s.post={success:!1,error:r.toString(),message:r.message}}s.browserTest={url:`${n}?action=test`,instruction:"Click the link below to test in a new tab"},p(s),o(!1)},d=s=>s?s.success||s.ok?e.jsx(N,{className:"w-5 h-5 text-green-500"}):e.jsx(w,{className:"w-5 h-5 text-red-500"}):e.jsx(h,{className:"w-5 h-5 text-gray-400"});return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 via-white to-yellow-50 pt-24 pb-20 px-4",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsx("h1",{className:"text-emerald-600 mb-2",children:"üîç Google Apps Script Diagnostics"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"This tool will help diagnose connection issues with your Google Apps Script backend."}),e.jsxs("div",{className:"mb-8 p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-gray-700 mb-2",children:e.jsx("strong",{children:"Script URL:"})}),e.jsx("code",{className:"text-xs break-all text-emerald-600",children:n})]}),e.jsx(j,{onClick:g,disabled:a,className:"w-full mb-8 bg-emerald-600 hover:bg-emerald-700",size:"lg",children:a?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-5 h-5 mr-2 animate-spin"}),"Running Diagnostics..."]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"w-5 h-5 mr-2"}),"Run Diagnostic Tests"]})}),Object.keys(t).length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[d(t.get),e.jsx("h3",{className:"text-gray-900",children:"Test 1: Basic Connection (GET Request)"})]}),t.get?.success===!1?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"bg-red-50 text-red-700 p-4 rounded-lg",children:[e.jsx("p",{className:"font-semibold mb-2",children:"‚ùå Connection Failed"}),e.jsx("p",{className:"text-sm mb-2",children:t.get.error}),t.get.error?.includes("Failed to fetch")&&e.jsxs("div",{className:"mt-4 text-sm",children:[e.jsx("p",{className:"font-semibold mb-2",children:"This usually means:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Google Apps Script is not deployed correctly"}),e.jsx("li",{children:"The script URL is wrong"}),e.jsx("li",{children:`The deployment doesn't have "Anyone" access`})]})]})]})}):e.jsxs("div",{className:"bg-green-50 text-green-700 p-4 rounded-lg",children:[e.jsx("p",{className:"font-semibold mb-2",children:"‚úÖ Connection Successful"}),e.jsx("pre",{className:"text-xs overflow-auto",children:JSON.stringify(t.get.data,null,2)})]})]}),e.jsxs("div",{className:"border rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[d(t.post),e.jsx("h3",{className:"text-gray-900",children:"Test 2: Registration (POST Request)"})]}),t.post?.success===!1?e.jsxs("div",{className:"bg-red-50 text-red-700 p-4 rounded-lg",children:[e.jsx("p",{className:"font-semibold mb-2",children:"‚ùå POST Request Failed"}),e.jsx("p",{className:"text-sm",children:t.post.error})]}):t.post?.success===!0?e.jsxs("div",{className:"bg-green-50 text-green-700 p-4 rounded-lg",children:[e.jsx("p",{className:"font-semibold mb-2",children:"‚úÖ Registration Working"}),e.jsx("pre",{className:"text-xs overflow-auto",children:JSON.stringify(t.post.data,null,2)})]}):t.post?.data?e.jsxs("div",{className:"bg-yellow-50 text-yellow-700 p-4 rounded-lg",children:[e.jsx("p",{className:"font-semibold mb-2",children:"‚ö†Ô∏è Got Response but Registration Failed"}),e.jsx("pre",{className:"text-xs overflow-auto",children:JSON.stringify(t.post.data,null,2)})]}):null]}),e.jsxs("div",{className:"border rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(h,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"text-gray-900",children:"Test 3: Direct Browser Test"})]}),e.jsxs("div",{className:"bg-blue-50 text-blue-700 p-4 rounded-lg",children:[e.jsx("p",{className:"mb-3",children:"Click this link to test the script directly in your browser:"}),e.jsx("a",{href:t.browserTest.url,target:"_blank",rel:"noopener noreferrer",className:"inline-block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Open in New Tab"}),e.jsxs("p",{className:"mt-3 text-sm",children:[e.jsx("strong",{children:"Expected:"})," You should see JSON data like ",'{"success": true, "message": "..."}']}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"If you see an error:"})," The script is not deployed correctly"]})]})]}),t.get?.success===!1&&e.jsxs("div",{className:"border-2 border-orange-500 rounded-lg p-6 bg-orange-50",children:[e.jsx("h3",{className:"text-orange-900 mb-4",children:"üìã Fix Instructions"}),e.jsxs("div",{className:"space-y-4 text-sm text-orange-900",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-2",children:"Step 1: Open Google Apps Script"}),e.jsx("p",{children:"1. Open your Google Sheet"}),e.jsxs("p",{children:["2. Go to ",e.jsx("strong",{children:"Extensions ‚Üí Apps Script"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-2",children:"Step 2: Verify the Code is Saved"}),e.jsx("p",{children:"1. Make sure you pasted the complete code"}),e.jsxs("p",{children:["2. Click ",e.jsx("strong",{children:"üíæ Save"})," (Ctrl+S)"]}),e.jsx("p",{children:"3. Look for any red error indicators"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-2",children:"Step 3: Redeploy"}),e.jsxs("p",{children:["1. Click ",e.jsx("strong",{children:"Deploy ‚Üí Manage deployments"})]}),e.jsxs("p",{children:["2. Click the ",e.jsx("strong",{children:"Edit"})," button (pencil icon)"]}),e.jsxs("p",{children:["3. Click ",e.jsx("strong",{children:"New version"})]}),e.jsxs("p",{children:["4. Click ",e.jsx("strong",{children:"Deploy"})]}),e.jsx("p",{children:"5. Copy the new URL and update your frontend"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-2",children:"Step 4: Verify Settings"}),e.jsx("p",{children:"Make sure these settings are correct:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 ml-4",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Execute as:"})," Me (your-email@gmail.com)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Who has access:"})," Anyone"]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg mt-4",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Alternative: Create Fresh Deployment"}),e.jsxs("p",{children:["1. Click ",e.jsx("strong",{children:"Deploy ‚Üí Manage deployments"})]}),e.jsx("p",{children:"2. Delete ALL existing deployments"}),e.jsxs("p",{children:["3. Click ",e.jsx("strong",{children:"Deploy ‚Üí New deployment"})]}),e.jsxs("p",{children:["4. Select ",e.jsx("strong",{children:"Web app"})]}),e.jsxs("p",{children:["5. Set access to ",e.jsx("strong",{children:"Anyone"})]}),e.jsx("p",{children:"6. Copy the new URL"})]})]})]})]})]})})})}export{O as DiagnosticPage};
