<!DOCTYPE html>
<html>
<head>
    <title>YourHelpa - Debug Console</title>
    <meta charset="UTF-8">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #1BBF72;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .panel {
            background: #2a2a2a;
            border: 2px solid #1BBF72;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .panel h2 {
            color: #FFD54F;
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .log {
            background: #000;
            padding: 15px;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
            font-size: 13px;
            line-height: 1.6;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #1BBF72;
            padding-left: 10px;
        }
        
        .log-entry.error {
            border-left-color: #ff4444;
            color: #ff4444;
        }
        
        .log-entry.success {
            border-left-color: #00ff00;
            color: #00ff00;
        }
        
        .log-entry.info {
            border-left-color: #FFD54F;
            color: #FFD54F;
        }
        
        button {
            background: #1BBF72;
            color: #000;
            border: none;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-family: 'Courier New', monospace;
        }
        
        button:hover {
            background: #159f5f;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        input {
            background: #000;
            color: #00ff00;
            border: 2px solid #1BBF72;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            width: 100%;
            margin: 5px 0;
        }
        
        .status-bar {
            background: #000;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.online {
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }
        
        .status-indicator.offline {
            background: #ff4444;
            box-shadow: 0 0 10px #ff4444;
        }
        
        .json-display {
            background: #000;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß YOURHELPA DEBUG CONSOLE</h1>
        
        <!-- Status Bar -->
        <div class="status-bar">
            <div>
                <span class="status-indicator" id="apiStatus"></span>
                <span id="statusText">Checking...</span>
            </div>
            <div id="timestamp"></div>
        </div>
        
        <!-- Configuration Panel -->
        <div class="panel">
            <h2>üìç CONFIGURATION</h2>
            <div>
                <strong>API URL:</strong>
                <input type="text" id="apiUrl" value="https://script.google.com/macros/s/AKfycbz8PasKHgjeBS5DjJ8KS5g0eqW82Yb6P9t5X0ttXD2w9Y878lsV7jRegrRiDHq8LkeI/exec" readonly>
            </div>
            <div>
                <strong>Sheet URL:</strong>
                <input type="text" value="https://docs.google.com/spreadsheets/d/1wUMm6eQeGZr4cs4fx3rf0aLnJbWoM1NJ92psRK-AJKQ/edit" readonly>
            </div>
        </div>
        
        <!-- Test Controls -->
        <div class="panel">
            <h2>üß™ TESTS</h2>
            <div class="controls">
                <button onclick="testHealth()">1. Health Check (GET)</button>
                <button onclick="testPost()">2. POST Test</button>
                <button onclick="testSignup()">3. Test Signup</button>
                <button onclick="clearLogs()">Clear Logs</button>
                <button onclick="openSheet()">Open Sheet</button>
            </div>
        </div>
        
        <!-- Signup Form -->
        <div class="panel">
            <h2>üë§ TEST SIGNUP FORM</h2>
            <form onsubmit="submitSignup(event)">
                <input type="text" id="firstName" placeholder="First Name" value="Test User">
                <input type="email" id="email" placeholder="Email" required>
                <input type="tel" id="phone" placeholder="Phone" value="+2348012345678">
                <input type="password" id="password" placeholder="Password" value="Test123!">
                <button type="submit">üöÄ CREATE ACCOUNT NOW</button>
            </form>
        </div>
        
        <!-- Logs -->
        <div class="panel">
            <h2>üìú CONSOLE LOGS</h2>
            <div class="log" id="logConsole"></div>
        </div>
        
        <!-- Last Response -->
        <div class="panel">
            <h2>üìä LAST RESPONSE</h2>
            <div class="json-display" id="lastResponse">No response yet</div>
        </div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbz8PasKHgjeBS5DjJ8KS5g0eqW82Yb6P9t5X0ttXD2w9Y878lsV7jRegrRiDHq8LkeI/exec';
        let logCount = 0;

        function updateTimestamp() {
            document.getElementById('timestamp').textContent = new Date().toLocaleTimeString();
        }
        
        setInterval(updateTimestamp, 1000);
        updateTimestamp();

        function log(message, type = 'info') {
            logCount++;
            const logConsole = document.getElementById('logConsole');
            const entry = document.createElement('div');
            entry.className = 'log-entry ' + type;
            const time = new Date().toLocaleTimeString();
            entry.innerHTML = `[${time}] ${message}`;
            logConsole.insertBefore(entry, logConsole.firstChild);
            
            // Auto-scroll if at bottom
            if (logConsole.scrollHeight - logConsole.scrollTop === logConsole.clientHeight) {
                logConsole.scrollTop = logConsole.scrollHeight;
            }
            
            console.log(`[${type.toUpperCase()}]`, message);
        }

        function showResponse(data) {
            document.getElementById('lastResponse').textContent = JSON.stringify(data, null, 2);
        }

        function setStatus(online, text) {
            const indicator = document.getElementById('apiStatus');
            const statusText = document.getElementById('statusText');
            
            indicator.className = 'status-indicator ' + (online ? 'online' : 'offline');
            statusText.textContent = text;
        }

        async function testHealth() {
            log('üîç Testing GET request to Google Apps Script...', 'info');
            
            try {
                const startTime = performance.now();
                
                const response = await fetch(API_URL, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                const endTime = performance.now();
                const duration = (endTime - startTime).toFixed(2);
                
                log(`üì° Response received in ${duration}ms`, 'info');
                log(`üìä Status: ${response.status} ${response.statusText}`, 'info');
                
                const text = await response.text();
                const data = JSON.parse(text);
                
                showResponse(data);
                
                if (data.success) {
                    log('‚úÖ SUCCESS! API is online and responding', 'success');
                    log(`‚úÖ Message: ${data.message}`, 'success');
                    log(`‚úÖ Timestamp: ${data.timestamp}`, 'success');
                    setStatus(true, 'API Online');
                } else {
                    log('‚ö†Ô∏è API responded but success=false', 'error');
                    log(`Error: ${data.error || 'Unknown'}`, 'error');
                    setStatus(false, 'API Error');
                }
            } catch (error) {
                log('‚ùå HEALTH CHECK FAILED!', 'error');
                log(`Error: ${error.message}`, 'error');
                log(`Type: ${error.constructor.name}`, 'error');
                setStatus(false, 'API Offline');
                showResponse({ error: error.message, stack: error.stack });
                
                log('', 'error');
                log('üî¥ DIAGNOSIS:', 'error');
                log('  1. Google Apps Script not deployed', 'error');
                log('  2. Script not authorized', 'error');
                log('  3. Wrong deployment settings', 'error');
                log('', 'error');
                log('üìù SOLUTION: Open /FIX_SIGNUP_NOW.md', 'error');
            }
        }

        async function testPost() {
            log('üì§ Testing POST request capability...', 'info');
            
            try {
                const testData = {
                    action: 'test',
                    timestamp: new Date().toISOString(),
                    debug: true
                };
                
                log(`üì¶ Sending data: ${JSON.stringify(testData)}`, 'info');
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                log(`üìä Status: ${response.status}`, 'info');
                
                const text = await response.text();
                const data = JSON.parse(text);
                
                showResponse(data);
                
                log('‚úÖ POST request successful!', 'success');
                log('‚úÖ API can receive JSON data', 'success');
                log('‚úÖ CORS is configured correctly', 'success');
            } catch (error) {
                log('‚ùå POST REQUEST FAILED!', 'error');
                log(`Error: ${error.message}`, 'error');
                log('', 'error');
                log('üî¥ This means the API cannot accept POST requests', 'error');
                log('üìù Check deployment settings (Step 6 in /FIX_SIGNUP_NOW.md)', 'error');
                showResponse({ error: error.message });
            }
        }

        async function testSignup() {
            const email = 'autotest' + Date.now() + '@example.com';
            
            log('üë§ Testing real signup with auto-generated email...', 'info');
            log(`üìß Email: ${email}`, 'info');
            
            await submitSignupWithData({
                firstName: 'Auto Test',
                email: email,
                phone: '+2348012345678',
                password: 'Test123!'
            });
        }

        async function submitSignup(event) {
            event.preventDefault();
            
            const data = {
                firstName: document.getElementById('firstName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                password: document.getElementById('password').value
            };
            
            await submitSignupWithData(data);
        }

        async function submitSignupWithData(data) {
            log('üöÄ CREATING ACCOUNT...', 'info');
            log('', 'info');
            log(`üìù First Name: ${data.firstName}`, 'info');
            log(`üìß Email: ${data.email}`, 'info');
            log(`üì± Phone: ${data.phone}`, 'info');
            log(`üîí Password: ${data.password.replace(/./g, '*')}`, 'info');
            log('', 'info');
            
            try {
                const requestData = {
                    action: 'register',
                    email: data.email,
                    password: data.password,
                    firstName: data.firstName,
                    phone: data.phone
                };
                
                log('üì§ Sending POST request...', 'info');
                log(`üì¶ Data: ${JSON.stringify(requestData, null, 2)}`, 'info');
                
                const startTime = performance.now();
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const endTime = performance.now();
                const duration = (endTime - startTime).toFixed(2);
                
                log(`üì° Response received in ${duration}ms`, 'info');
                log(`üìä Status: ${response.status} ${response.statusText}`, 'info');
                
                const text = await response.text();
                log(`üìÑ Raw response: ${text.substring(0, 200)}...`, 'info');
                
                const responseData = JSON.parse(text);
                showResponse(responseData);
                
                if (responseData.success) {
                    log('', 'success');
                    log('üéâüéâüéâ ACCOUNT CREATED SUCCESSFULLY! üéâüéâüéâ', 'success');
                    log('', 'success');
                    log(`‚úÖ User ID: ${responseData.user.id}`, 'success');
                    log(`‚úÖ Name: ${responseData.user.firstName}`, 'success');
                    log(`‚úÖ Email: ${responseData.user.email}`, 'success');
                    log(`‚úÖ Phone: ${responseData.user.phone}`, 'success');
                    log(`‚úÖ Created: ${responseData.user.createdAt}`, 'success');
                    log('', 'success');
                    log(`üîë Session Token: ${responseData.sessionToken}`, 'success');
                    log('', 'success');
                    log('üìä CHECK YOUR GOOGLE SHEET NOW!', 'success');
                    log('   Go to "Users" tab and see the new entry', 'success');
                    log('', 'success');
                    log('‚úÖ‚úÖ‚úÖ YOUR SIGNUP IS WORKING! ‚úÖ‚úÖ‚úÖ', 'success');
                    
                    setStatus(true, 'Signup Working!');
                } else {
                    log('', 'error');
                    log('‚ùå SIGNUP FAILED!', 'error');
                    log(`Error: ${responseData.error}`, 'error');
                    log('', 'error');
                    
                    if (responseData.error && responseData.error.includes('already exists')) {
                        log('‚ÑπÔ∏è This email is already registered', 'info');
                        log('‚ÑπÔ∏è Try a different email address', 'info');
                        log('‚ÑπÔ∏è This actually means the API is working!', 'info');
                    } else {
                        log('üî¥ Possible issues:', 'error');
                        log('  1. Apps Script code is outdated', 'error');
                        log('  2. Missing required fields', 'error');
                        log('  3. Script not properly deployed', 'error');
                    }
                }
            } catch (error) {
                log('', 'error');
                log('‚ùå‚ùå‚ùå REQUEST FAILED! ‚ùå‚ùå‚ùå', 'error');
                log('', 'error');
                log(`Error: ${error.message}`, 'error');
                log(`Type: ${error.constructor.name}`, 'error');
                log('', 'error');
                log('üî¥ CRITICAL ISSUE:', 'error');
                log('Cannot connect to Google Apps Script!', 'error');
                log('', 'error');
                log('üìù IMMEDIATE ACTION REQUIRED:', 'error');
                log('1. Open /FIX_SIGNUP_NOW.md', 'error');
                log('2. Follow ALL deployment steps', 'error');
                log('3. Make sure "Who has access" = Anyone', 'error');
                log('4. Authorize the script when prompted', 'error');
                
                showResponse({ error: error.message, stack: error.stack });
                setStatus(false, 'Connection Failed');
            }
        }

        function clearLogs() {
            document.getElementById('logConsole').innerHTML = '';
            logCount = 0;
            log('üóëÔ∏è Logs cleared', 'info');
        }

        function openSheet() {
            window.open('https://docs.google.com/spreadsheets/d/1wUMm6eQeGZr4cs4fx3rf0aLnJbWoM1NJ92psRK-AJKQ/edit', '_blank');
            log('üìä Opening Google Sheet in new tab...', 'info');
        }

        // Auto-run health check on load
        window.onload = function() {
            log('üöÄ Debug Console Started', 'success');
            log('üìç API URL: ' + API_URL, 'info');
            log('', 'info');
            
            // Generate random email
            const randomEmail = 'test' + Date.now() + '@example.com';
            document.getElementById('email').value = randomEmail;
            log(`üìß Auto-generated test email: ${randomEmail}`, 'info');
            
            // Auto-test after 1 second
            setTimeout(() => {
                log('üîÑ Running automatic health check...', 'info');
                testHealth();
            }, 1000);
        };
    </script>
</body>
</html>
